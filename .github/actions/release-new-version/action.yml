
name: 'Release new version'
description: 'Retrieve environment for current repository'
inputs:
  version:
    type: string
    description: Release version number
    required: true
  description:
    type: string
    description: Release description
    required: false

runs:   
  using: composite
  steps:
    - name: Commit & Push new version and new packages
      uses: actions-js/push@master
      with:
        github_token: ${{ secrets.GITHUB_TOKEN }}
        branch: ${{ github.ref }}"
        message: '[github_action][skip ci] update version to ${{ github.action.inputs.version }}'

    - name: Create Git Tag
      id: tag_version
      uses: mathieudutour/github-tag-action@v6.1
      with:
        github_token: ${{ secrets.GITHUB_TOKEN }}
        custom_tag:  ${{ github.action.inputs.version }}
  
    - name: Create a GitHub release
      uses: ncipollo/release-action@v1
      with:
        tag: ${{ steps.tag_version.outputs.new_tag }}
        name: Release ${{ steps.tag_version.outputs.new_tag }}
        description: ${{ github.action.inputs.description }}
        body: ${{ steps.tag_version.outputs.changelog }}